<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý Tồn kho - Feane Restaurant</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Custom CSS -->
    <style>
        :root {
            --primary-color: #ffbe33;
            --secondary-color: #222831;
            --light-color: #ffffff;
            --dark-color: #121618;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            overflow-x: hidden;
        }
        
        .sidebar {
            min-height: 100vh;
            background-color: var(--secondary-color);
            color: var(--light-color);
            transition: all 0.3s;
            position: fixed;
            z-index: 100;
            width: 250px;
        }
        
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 0.75rem 1rem;
            margin: 0.25rem 0;
            border-radius: 0.25rem;
            transition: all 0.2s;
        }
        
        .sidebar .nav-link:hover, 
        .sidebar .nav-link.active {
            background-color: var(--primary-color);
            color: var(--dark-color);
        }
        
        .sidebar .nav-link i {
            width: 20px;
            margin-right: 10px;
        }
        
        .main-content {
            margin-left: 250px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .navbar-custom {
            background-color: var(--light-color);
            box-shadow: 0 2px 4px rgba(0,0,0,.1);
        }
        
        .card-custom {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,.1);
            transition: transform 0.3s;
        }
        
        .card-custom:hover {
            transform: translateY(-5px);
        }
        
        .filter-section {
            background-color: var(--primary-color);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .filter-section h3 {
            margin-bottom: 20px;
            color: var(--dark-color);
        }
        
        .table-responsive {
            border-radius: 10px;
            overflow: hidden;
        }
        
        .table th {
            background-color: var(--secondary-color);
            color: var(--light-color);
        }
        
        .btn-custom {
            background-color: var(--primary-color);
            color: var(--dark-color);
            border: none;
            border-radius: 5px;
            padding: 8px 15px;
            transition: all 0.3s;
        }
        
        .btn-custom:hover {
            background-color: #e6a500;
            transform: translateY(-2px);
        }
        
        .toggle-sidebar {
            display: none;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
                text-align: center;
            }
            
            .sidebar .nav-link span {
                display: none;
            }
            
            .sidebar .nav-link i {
                margin-right: 0;
            }
            
            .main-content {
                margin-left: 70px;
            }
            
            .toggle-sidebar {
                display: block;
            }
        }
        
        .badge-status-new {
            background-color: #17a2b8;
        }
        
        .badge-status-processing {
            background-color: #ffc107;
            color: #212529;
        }
        
        .badge-status-shipped {
            background-color: #28a745;
        }
        
        .badge-status-cancelled {
            background-color: #dc3545;
        }
        
        .action-buttons .btn {
            margin-right: 5px;
        }
        
        .warning {
            color: #dc3545;
            font-weight: bold;
        }
        
        .low-stock {
            background-color: #ffdddd;
        }
        
        .search-box {
            position: relative;
        }
        
        .search-box input {
            padding-right: 40px;
        }
        
        .search-box i {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
        }
        
        .product-link {
            color: var(--secondary-color);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        
        .product-link:hover {
            color: var(--primary-color);
            text-decoration: underline;
        }
        
        .stat-card {
            text-align: center;
            padding: 20px;
            color: white;
        }
        
        .stat-card i {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .bg-primary-custom {
            background-color: #007bff !important;
        }
        
        .stock-status-low {
            background-color: #ffdddd;
        }
        
        .stock-status-adequate {
            background-color: #ddffdd;
        }
        
        .date-range-filter {
            background-color: rgba(255, 255, 255, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .detail-search-section {
            background-color: #e9ecef;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid var(--primary-color);
        }
        
        .detail-search-result {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,.1);
        }
        
        .summary-card {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            color: white;
            margin-bottom: 15px;
        }
        
        .summary-card.import {
            background-color: #17a2b8;
        }
        
        .summary-card.export {
            background-color: #28a745;
        }
        
        .summary-card.stock {
            background-color: #6c757d;
        }
    </style>
</head>
<body>
    <!-- Trang quản trị -->
    <div id="admin-page">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="p-3">
                <h4 class="text-center mb-4"><i class="fas fa-utensils"></i> Feane Admin</h4>
            </div>
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link" href="admin.html">
                        <i class="fas fa-tachometer-alt"></i> <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="users.html">
                        <i class="fas fa-users"></i> <span>Quản lý người dùng</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="categories.html">
                        <i class="fas fa-tags"></i> <span>Loại sản phẩm</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="products.html">
                        <i class="fas fa-hamburger"></i> <span>Sản phẩm</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="imports.html">
                        <i class="fas fa-arrow-down"></i> <span>Nhập sản phẩm</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="pricing.html">
                        <i class="fas fa-dollar-sign"></i> <span>Giá bán</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="orders.html">
                        <i class="fas fa-shopping-cart"></i> <span>Đơn hàng</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="inventory.html">
                        <i class="fas fa-boxes"></i> <span>Tồn kho</span>
                    </a>
                </li>
                <li class="nav-item mt-4">
                   <a class="nav-link" href="adminlogin.html" id="logout-btn">
                        <i class="fas fa-sign-out-alt"></i> <span>Đăng xuất</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Navbar -->
            <nav class="navbar navbar-expand-lg navbar-custom mb-4">
                <div class="container-fluid">
                    <button class="btn toggle-sidebar" id="toggle-sidebar">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="d-flex align-items-center">
                        <span class="navbar-text me-3">
                            Xin chào, <strong>Admin</strong>
                        </span>
                        <div class="dropdown">
                            <button class="btn" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-user-circle fa-lg"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton">
                                <li><a class="dropdown-item" href="profile.html"><i class="fas fa-user me-2"></i> Hồ sơ</a></li>
                                <li><a class="dropdown-item" href="settings.html"><i class="fas fa-cog me-2"></i> Cài đặt</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="index.html"><i class="fas fa-sign-out-alt me-2"></i> Về trang chủ</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </nav>

            <!-- Page Content -->
            <div id="stock-management-page" class="page-content">
                <h2 class="mb-4">Quản lý Tồn kho</h2>
                
                <!-- Filter Section -->
                <div class="filter-section">
                    <h3><i class="fas fa-filter me-2"></i>Bộ lọc tồn kho</h3>
                    <form id="stock-filter-form">
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="search-name" class="form-label">Tìm sản phẩm</label>
                                <input type="text" class="form-control" id="search-name" name="search" placeholder="Nhập tên sản phẩm...">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="filter-type" class="form-label">Loại sản phẩm</label>
                                <select class="form-select" id="filter-type" name="type">
                                    <option value="">Tất cả</option>
                                    <option value="Pizza">Pizza</option>
                                    <option value="Fries">Fries</option>
                                    <option value="Burger">Burger</option>
                                    <option value="Pasta">Pasta</option>
                                </select>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="stock-status" class="form-label">Trạng thái tồn kho</label>
                                <select class="form-select" id="stock-status" name="stock-status">
                                    <option value="">Tất cả</option>
                                    <option value="low">Sắp hết hàng</option>
                                    <option value="adequate">Đủ hàng</option>
                                </select>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="sort-by" class="form-label">Sắp xếp theo</label>
                                <select class="form-select" id="sort-by" name="sort">
                                    <option value="name">Tên sản phẩm</option>
                                    <option value="stock">Số lượng tồn</option>
                                    <option value="type">Loại sản phẩm</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Date Range Filter -->
                        <div class="date-range-filter">
                            <h5 class="mb-3"><i class="fas fa-calendar-alt me-2"></i>Kiểm tra tồn kho theo ngày</h5>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="date-from" class="form-label">Từ ngày</label>
                                    <input type="date" class="form-control" id="date-from" name="date-from">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="date-to" class="form-label">Đến ngày</label>
                                    <input type="date" class="form-control" id="date-to" name="date-to">
                                </div>
                                <div class="col-md-4 mb-3 d-flex align-items-end">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="enable-date-filter" name="enable-date-filter">
                                        <label class="form-check-label" for="enable-date-filter">
                                            Áp dụng lọc ngày
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-3">
                            <div class="col-12">
                                <button type="submit" class="btn btn-dark">
                                    <i class="fas fa-search me-2"></i>Tìm kiếm
                                </button>
                                <button type="reset" class="btn btn-outline-dark ms-2">
                                    <i class="fas fa-undo me-2"></i>Đặt lại
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
                
                <!-- Detail Search Section -->
                <div class="detail-search-section">
                    <h3><i class="fas fa-chart-line me-2"></i>Tra cứu chi tiết nhập - xuất - tồn</h3>
                    <form id="detail-search-form">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="detail-product" class="form-label">Chọn sản phẩm</label>
                                <select class="form-select" id="detail-product" name="detail-product">
                                    <option value="">-- Chọn sản phẩm --</option>
                                    <!-- Options will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="detail-date-from" class="form-label">Từ ngày</label>
                                <input type="date" class="form-control" id="detail-date-from" name="detail-date-from">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="detail-date-to" class="form-label">Đến ngày</label>
                                <input type="date" class="form-control" id="detail-date-to" name="detail-date-to">
                            </div>
                            <div class="col-md-2 mb-3 d-flex align-items-end">
                                <button type="submit" class="btn btn-dark w-100">
                                    <i class="fas fa-search me-2"></i>Tra cứu
                                </button>
                            </div>
                        </div>
                    </form>
                    
                    <!-- Detail Search Result -->
                    <div id="detail-search-result" class="detail-search-result">
                        <h5>Kết quả tra cứu</h5>
                        <div class="row mb-4">
                            <div class="col-md-4">
                                <div class="summary-card import">
                                    <i class="fas fa-arrow-down fa-2x"></i>
                                    <h4 id="total-import">0</h4>
                                    <p>Tổng nhập</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="summary-card export">
                                    <i class="fas fa-arrow-up fa-2x"></i>
                                    <h4 id="total-export">0</h4>
                                    <p>Tổng xuất</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="summary-card stock">
                                    <i class="fas fa-boxes fa-2x"></i>
                                    <h4 id="total-stock">0</h4>
                                    <p>Tồn cuối kỳ</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead class="table-light">
                                    <tr>
                                        <th>Ngày</th>
                                        <th>Loại giao dịch</th>
                                        <th>Số lượng</th>
                                        <th>Đơn vị</th>
                                        <th>Ghi chú</th>
                                    </tr>
                                </thead>
                                <tbody id="detail-result-body">
                                    <!-- Detail data will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Statistics Cards -->
                <div class="row dashboard-stats mb-4">
                    <div class="col-md-4">
                        <a href="inventory.html" style="text-decoration: none; display: block;">
                            <div class="card card-custom bg-primary-custom">
                                <div class="card-body stat-card">
                                    <i class="fas fa-boxes"></i>
                                    <h3 id="total-products">8</h3>
                                    <p>Tổng sản phẩm</p>
                                </div>
                            </div>
                        </a>
                    </div>
                    <div class="col-md-4">
                        <a href="inventory.html?stock-status=adequate" style="text-decoration: none; display: block;">
                            <div class="card card-custom" style="background-color: #28a745; color: white;">
                                <div class="card-body stat-card">
                                    <i class="fas fa-check-circle"></i>
                                    <h3 id="in-stock-products">5</h3>
                                    <p>Sản phẩm đủ hàng</p>
                                </div>
                            </div>
                        </a>
                    </div>
                    <div class="col-md-4">
                        <a href="inventory.html?stock-status=low" style="text-decoration: none; display: block;">
                            <div class="card card-custom" style="background-color: #dc3545; color: white;">
                                <div class="card-body stat-card">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <h3 id="low-stock-products">3</h3>
                                    <p>Sản phẩm sắp hết</p>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
                
                <!-- Stock Table -->
                <div class="card card-custom">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">Danh sách tồn kho</h5>
                        <div class="search-box">
                            <div class="input-group">
                                <input type="text" class="form-control" placeholder="Tìm kiếm sản phẩm..." id="search-stock-input">
                                <button class="btn btn-outline-secondary" id="search-stock-btn">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Mã SP</th>
                                        <th>Tên sản phẩm</th>
                                        <th>Loại</th>
                                        <th>Số lượng nhập</th>
                                        <th>Số lượng xuất</th>
                                        <th>Số lượng tồn</th>
                                        <th>Trạng thái</th>
                                        <th>Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody id="stock-table-body">
                                    <!-- Dữ liệu sẽ được tải động dựa trên bộ lọc -->
                                </tbody>
                            </table>
                        </div>
                        <!-- Pagination -->
                        <nav aria-label="Page navigation">
                            <ul class="pagination justify-content-center mt-4">
                                <li class="page-item disabled">
                                    <a class="page-link" href="#" tabindex="-1">Trước</a>
                                </li>
                                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                <li class="page-item"><a class="page-link" href="#">2</a></li>
                                <li class="page-item"><a class="page-link" href="#">3</a></li>
                                <li class="page-item">
                                    <a class="page-link" href="#">Tiếp</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Xử lý toggle sidebar trên mobile
            document.getElementById('toggle-sidebar').addEventListener('click', function() {
                const sidebar = document.querySelector('.sidebar');
                const mainContent = document.querySelector('.main-content');
                
                if (sidebar.style.width === '70px' || sidebar.style.width === '') {
                    sidebar.style.width = '250px';
                    mainContent.style.marginLeft = '250px';
                    
                    // Hiển thị text trong sidebar
                    const navTexts = document.querySelectorAll('.sidebar .nav-link span');
                    navTexts.forEach(text => text.style.display = 'inline');
                } else {
                    sidebar.style.width = '70px';
                    mainContent.style.marginLeft = '70px';
                    
                    // Ẩn text trong sidebar
                    const navTexts = document.querySelectorAll('.sidebar .nav-link span');
                    navTexts.forEach(text => text.style.display = 'none');
                }
            });
            
            // Xử lý form lọc tồn kho
            document.getElementById('stock-filter-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const search = document.getElementById('search-name').value;
                const type = document.getElementById('filter-type').value;
                const stockStatus = document.getElementById('stock-status').value;
                const sort = document.getElementById('sort-by').value;
                const dateFrom = document.getElementById('date-from').value;
                const dateTo = document.getElementById('date-to').value;
                const enableDateFilter = document.getElementById('enable-date-filter').checked;
                
                // Tạo URL với các tham số lọc
                let url = 'inventory.html?';
                let params = [];
                
                if (search) params.push(`search=${encodeURIComponent(search)}`);
                if (type) params.push(`type=${encodeURIComponent(type)}`);
                if (stockStatus) params.push(`stock-status=${stockStatus}`);
                if (sort) params.push(`sort=${sort}`);
                if (enableDateFilter && dateFrom) params.push(`date-from=${dateFrom}`);
                if (enableDateFilter && dateTo) params.push(`date-to=${dateTo}`);
                if (enableDateFilter) params.push(`enable-date-filter=true`);
                
                url += params.join('&');
                
                // Chuyển hướng đến trang với bộ lọc
                window.location.href = url;
            });
            
            // Xử lý nút tìm kiếm sản phẩm
            document.getElementById('search-stock-btn').addEventListener('click', function() {
                const searchTerm = document.getElementById('search-stock-input').value;
                if (searchTerm) {
                    window.location.href = `inventory.html?search=${encodeURIComponent(searchTerm)}`;
                }
            });
            
            // Xử lý nút đặt lại
            document.querySelector('button[type="reset"]').addEventListener('click', function() {
                window.location.href = 'inventory.html';
            });
            
            // Xử lý form tra cứu chi tiết
            document.getElementById('detail-search-form').addEventListener('submit', function(e) {
                e.preventDefault();
                performDetailSearch();
            });
            
            // Tải dữ liệu tồn kho dựa trên URL parameters
            loadStockFromURL();
            
            // Đặt giá trị mặc định cho ngày (30 ngày gần nhất)
            setDefaultDateRange();
            
            // Điền danh sách sản phẩm vào dropdown
            populateProductSelect();
        });
        
        // Hàm đặt khoảng ngày mặc định (30 ngày gần nhất)
        function setDefaultDateRange() {
            const today = new Date();
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(today.getDate() - 30);
            
            // Định dạng ngày thành YYYY-MM-DD
            const formatDate = (date) => {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            };
            
            document.getElementById('date-from').value = formatDate(thirtyDaysAgo);
            document.getElementById('date-to').value = formatDate(today);
            
            // Cũng đặt cho form tra cứu chi tiết
            document.getElementById('detail-date-from').value = formatDate(thirtyDaysAgo);
            document.getElementById('detail-date-to').value = formatDate(today);
        }
        
        // Hàm điền danh sách sản phẩm vào dropdown
        function populateProductSelect() {
            const productSelect = document.getElementById('detail-product');
            
            // Dữ liệu mẫu với thông tin chi tiết
            const stockItems = [
                { 
                    id: 'SP01', 
                    name: 'Pizza Hải Sản', 
                    type: 'Pizza', 
                    importQty: 100, 
                    exportQty: 95, 
                    stockQty: 5,
                    image: 'feane-1.0.0/images/f1.png',
                    lastImportDate: '15/05/2025',
                    lastExportDate: '14/05/2025'
                },
                { 
                    id: 'SP02', 
                    name: 'Burger Bò Phô Mai', 
                    type: 'Burger', 
                    importQty: 80, 
                    exportQty: 60, 
                    stockQty: 20,
                    image: 'feane-1.0.0/images/f2.png',
                    lastImportDate: '12/10/2025',
                    lastExportDate: '1/11/2025'
                },
                { 
                    id: 'SP03', 
                    name: 'Khoai Tây Chiên', 
                    type: 'Fries', 
                    importQty: 150, 
                    exportQty: 145, 
                    stockQty: 5,
                    image: 'feane-1.0.0/images/f4.png',
                    lastImportDate: '10/09/2025',
                    lastExportDate: '12/09/2025'
                },
                { 
                    id: 'SP04', 
                    name: 'Burger gà chiên', 
                    type: 'Burger', 
                    importQty: 120, 
                    exportQty: 115, 
                    stockQty: 5,
                    image: 'feane-1.0.0/images/f7.png',
                    lastImportDate: '13/10/2025',
                    lastExportDate: '14/10/2025'
                },
                { 
                    id: 'SP05', 
                    name: 'Mỳ Ý Sốt Bò Bằm', 
                    type: 'Pasta', 
                    importQty: 90, 
                    exportQty: 85, 
                    stockQty: 5,
                    image: 'feane-1.0.0/images/f6.png',
                    lastImportDate: '11/09/2025',
                    lastExportDate: '13/09/2025'
                },
                { 
                    id: 'SP06', 
                    name: 'Pasta Rau Củ', 
                    type: 'Pasta', 
                    importQty: 70, 
                    exportQty: 65, 
                    stockQty: 5,
                    image: 'feane-1.0.0/images/f7.png',
                    lastImportDate: '09/10/2025',
                    lastExportDate: '12/10/2025'
                }
            ];
            
            // Xóa các option hiện tại (trừ option đầu tiên)
            while (productSelect.options.length > 1) {
                productSelect.remove(1);
            }
            
            // Thêm các option mới
            stockItems.forEach(item => {
                const option = document.createElement('option');
                option.value = item.id;
                option.textContent = `${item.id} - ${item.name}`;
                productSelect.appendChild(option);
            });
        }
        
        // Hàm thực hiện tra cứu chi tiết
        function performDetailSearch() {
            const productId = document.getElementById('detail-product').value;
            const dateFrom = document.getElementById('detail-date-from').value;
            const dateTo = document.getElementById('detail-date-to').value;
            
            if (!productId) {
                alert('Vui lòng chọn sản phẩm!');
                return;
            }
            
            // Dữ liệu mẫu cho giao dịch chi tiết
            const transactionData = {
                'SP01': [
                    { date: '2025-05-01', type: 'import', quantity: 50, unit: 'cái', note: 'Nhập hàng từ NCC A' },
                    { date: '2025-05-10', type: 'import', quantity: 50, unit: 'cái', note: 'Nhập hàng từ NCC B' },
                    { date: '2025-05-15', type: 'export', quantity: 30, unit: 'cái', note: 'Bán cho khách hàng X' },
                    { date: '2025-05-20', type: 'export', quantity: 65, unit: 'cái', note: 'Bán cho khách hàng Y' }
                ],
                'SP02': [
                    { date: '2025-10-01', type: 'import', quantity: 40, unit: 'cái', note: 'Nhập hàng từ NCC C' },
                    { date: '2025-10-05', type: 'import', quantity: 40, unit: 'cái', note: 'Nhập hàng từ NCC D' },
                    { date: '2025-10-10', type: 'export', quantity: 25, unit: 'cái', note: 'Bán cho khách hàng Z' },
                    { date: '2025-10-15', type: 'export', quantity: 35, unit: 'cái', note: 'Bán cho khách hàng W' }
                ],
                'SP03': [
                    { date: '2025-09-01', type: 'import', quantity: 75, unit: 'phần', note: 'Nhập hàng từ NCC E' },
                    { date: '2025-09-05', type: 'import', quantity: 75, unit: 'phần', note: 'Nhập hàng từ NCC F' },
                    { date: '2025-09-10', type: 'export', quantity: 70, unit: 'phần', note: 'Bán cho khách hàng V' },
                    { date: '2025-09-15', type: 'export', quantity: 75, unit: 'phần', note: 'Bán cho khách hàng U' }
                ]
            };
            
            // Lấy dữ liệu giao dịch cho sản phẩm được chọn
            const transactions = transactionData[productId] || [];
            
            // Lọc theo khoảng thời gian
            let filteredTransactions = transactions;
            if (dateFrom || dateTo) {
                filteredTransactions = transactions.filter(transaction => {
                    const transactionDate = new Date(transaction.date);
                    const fromDate = dateFrom ? new Date(dateFrom) : null;
                    const toDate = dateTo ? new Date(dateTo) : null;
                    
                    if (fromDate && toDate) {
                        return transactionDate >= fromDate && transactionDate <= toDate;
                    } else if (fromDate) {
                        return transactionDate >= fromDate;
                    } else if (toDate) {
                        return transactionDate <= toDate;
                    }
                    return true;
                });
            }
            
            // Tính tổng nhập, xuất và tồn
            let totalImport = 0;
            let totalExport = 0;
            
            filteredTransactions.forEach(transaction => {
                if (transaction.type === 'import') {
                    totalImport += transaction.quantity;
                } else if (transaction.type === 'export') {
                    totalExport += transaction.quantity;
                }
            });
            
            const totalStock = totalImport - totalExport;
            
            // Cập nhật kết quả
            document.getElementById('total-import').textContent = totalImport;
            document.getElementById('total-export').textContent = totalExport;
            document.getElementById('total-stock').textContent = totalStock;
            
            // Cập nhật bảng chi tiết
            const resultBody = document.getElementById('detail-result-body');
            resultBody.innerHTML = '';
            
            if (filteredTransactions.length === 0) {
                resultBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center py-3">Không có giao dịch nào trong khoảng thời gian này.</td>
                    </tr>
                `;
            } else {
                filteredTransactions.forEach(transaction => {
                    const row = document.createElement('tr');
                    const typeText = transaction.type === 'import' ? 'Nhập hàng' : 'Xuất hàng';
                    const typeClass = transaction.type === 'import' ? 'text-success' : 'text-danger';
                    
                    row.innerHTML = `
                        <td>${formatDisplayDate(transaction.date)}</td>
                        <td><span class="${typeClass}">${typeText}</span></td>
                        <td>${transaction.quantity}</td>
                        <td>${transaction.unit}</td>
                        <td>${transaction.note}</td>
                    `;
                    resultBody.appendChild(row);
                });
            }
            
            // Hiển thị kết quả
            document.getElementById('detail-search-result').style.display = 'block';
        }
        
        // Hàm định dạng ngày hiển thị
        function formatDisplayDate(dateString) {
            const date = new Date(dateString);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }
        
        // Hàm tải dữ liệu tồn kho dựa trên URL parameters
        function loadStockFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const search = urlParams.get('search');
            const type = urlParams.get('type');
            const stockStatus = urlParams.get('stock-status');
            const sort = urlParams.get('sort');
            const dateFrom = urlParams.get('date-from');
            const dateTo = urlParams.get('date-to');
            const enableDateFilter = urlParams.get('enable-date-filter');
            
            // Dữ liệu mẫu với thông tin chi tiết
            const stockItems = [
                { 
                    id: 'SP01', 
                    name: 'Pizza Hải Sản', 
                    type: 'Pizza', 
                    importQty: 100, 
                    exportQty: 95, 
                    stockQty: 5,
                    image: 'feane-1.0.0/images/f1.png',
                    lastImportDate: '15/05/2025',
                    lastExportDate: '14/05/2025'
                },
                { 
                    id: 'SP02', 
                    name: 'Burger Bò Phô Mai', 
                    type: 'Burger', 
                    importQty: 80, 
                    exportQty: 60, 
                    stockQty: 20,
                    image: 'feane-1.0.0/images/f2.png',
                    lastImportDate: '12/10/2025',
                    lastExportDate: '1/11/2025'
                },
                { 
                    id: 'SP03', 
                    name: 'Khoai Tây Chiên', 
                    type: 'Fries', 
                    importQty: 150, 
                    exportQty: 145, 
                    stockQty: 5,
                    image: 'feane-1.0.0/images/f4.png',
                    lastImportDate: '10/09/2025',
                    lastExportDate: '12/09/2025'
                },
                { 
                    id: 'SP04', 
                    name: 'Burger gà chiên', 
                    type: 'Burger', 
                    importQty: 120, 
                    exportQty: 115, 
                    stockQty: 5,
                    image: 'feane-1.0.0/images/f7.png',
                    lastImportDate: '13/10/2025',
                    lastExportDate: '14/10/2025'
                },
                { 
                    id: 'SP05', 
                    name: 'Mỳ Ý Sốt Bò Bằm', 
                    type: 'Pasta', 
                    importQty: 90, 
                    exportQty: 85, 
                    stockQty: 5,
                    image: 'feane-1.0.0/images/f6.png',
                    lastImportDate: '11/09/2025',
                    lastExportDate: '13/09/2025'
                },
                { 
                    id: 'SP06', 
                    name: 'Pasta Rau Củ', 
                    type: 'Pasta', 
                    importQty: 70, 
                    exportQty: 65, 
                    stockQty: 5,
                    image: 'feane-1.0.0/images/f7.png',
                    lastImportDate: '09/10/2025',
                    lastExportDate: '12/10/2025'
                }
            ];
            
            // Lọc dữ liệu dựa trên các tham số
            let filteredItems = [...stockItems];
            
            if (search) {
                filteredItems = filteredItems.filter(item => 
                    item.name.toLowerCase().includes(search.toLowerCase()) || 
                    item.id.toLowerCase().includes(search.toLowerCase())
                );
            }
            
            if (type) {
                filteredItems = filteredItems.filter(item => item.type === type);
            }
            
            if (stockStatus) {
                if (stockStatus === 'low') {
                    filteredItems = filteredItems.filter(item => item.stockQty <= 10);
                } else if (stockStatus === 'adequate') {
                    filteredItems = filteredItems.filter(item => item.stockQty > 10);
                }
            }
            
            // Lọc theo ngày nếu được kích hoạt
            if (enableDateFilter && (dateFrom || dateTo)) {
                filteredItems = filteredItems.filter(item => {
                    // Giả lập việc lọc theo ngày (trong thực tế sẽ cần truy vấn cơ sở dữ liệu)
                    const itemDate = new Date(item.lastImportDate.split('/').reverse().join('-'));
                    let fromDate = dateFrom ? new Date(dateFrom) : null;
                    let toDate = dateTo ? new Date(dateTo) : null;
                    
                    if (fromDate && toDate) {
                        return itemDate >= fromDate && itemDate <= toDate;
                    } else if (fromDate) {
                        return itemDate >= fromDate;
                    } else if (toDate) {
                        return itemDate <= toDate;
                    }
                    return true;
                });
            }
            
            // Sắp xếp dữ liệu
            if (sort) {
                filteredItems.sort((a, b) => {
                    if (sort === 'name') {
                        return a.name.localeCompare(b.name);
                    } else if (sort === 'stock') {
                        return a.stockQty - b.stockQty;
                    } else if (sort === 'type') {
                        return a.type.localeCompare(b.type);
                    }
                    return 0;
                });
            }
            
            // Cập nhật bảng tồn kho
            updateStockTable(filteredItems);
            
            // Cập nhật thống kê
            updateStockStats(filteredItems);
            
            // Cập nhật giá trị trong form lọc
            updateFilterForm(urlParams);
        }
        
        // Hàm cập nhật bảng tồn kho
        function updateStockTable(items) {
            const tableBody = document.getElementById('stock-table-body');
            tableBody.innerHTML = '';
            
            if (items.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center py-4">
                            <i class="fas fa-search fa-2x mb-3 text-muted"></i>
                            <p class="text-muted">Không tìm thấy sản phẩm nào phù hợp với tiêu chí tìm kiếm.</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            items.forEach(item => {
                const status = item.stockQty <= 10 ? 'Sắp hết hàng!' : 'Đủ hàng';
                const statusClass = item.stockQty <= 10 ? 'warning' : '';
                const rowClass = item.stockQty <= 10 ? 'low-stock' : '';
                
                const row = document.createElement('tr');
                if (rowClass) row.className = rowClass;
                
                row.innerHTML = `
                    <td>${item.id}</td>
                    <td><a href="stockdetails.html?id=${item.id}" class="product-link">${item.name}</a></td>
                    <td><a href="inventory.html?type=${encodeURIComponent(item.type)}" class="product-link">${item.type}</a></td>
                    <td>${item.importQty}</td>
                    <td>${item.exportQty}</td>
                    <td>${item.stockQty}</td>
                    <td><span class="${statusClass}">${status}</span></td>
                    <td>
                        <a href="stockdetails.html?id=${item.id}" class="btn btn-sm btn-custom">
                            <i class="fas fa-eye me-1"></i>Xem
                        </a>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // Hàm cập nhật thống kê tồn kho
        function updateStockStats(items) {
            const totalProducts = items.length;
            const inStockProducts = items.filter(item => item.stockQty > 10).length;
            const lowStockProducts = items.filter(item => item.stockQty <= 10).length;
            
            document.getElementById('total-products').textContent = totalProducts;
            document.getElementById('in-stock-products').textContent = inStockProducts;
            document.getElementById('low-stock-products').textContent = lowStockProducts;
        }
        
        // Hàm cập nhật giá trị trong form lọc
        function updateFilterForm(urlParams) {
            const search = urlParams.get('search');
            const type = urlParams.get('type');
            const stockStatus = urlParams.get('stock-status');
            const sort = urlParams.get('sort');
            const dateFrom = urlParams.get('date-from');
            const dateTo = urlParams.get('date-to');
            const enableDateFilter = urlParams.get('enable-date-filter');
            
            if (search) document.getElementById('search-name').value = search;
            if (type) document.getElementById('filter-type').value = type;
            if (stockStatus) document.getElementById('stock-status').value = stockStatus;
            if (sort) document.getElementById('sort-by').value = sort;
            if (dateFrom) document.getElementById('date-from').value = dateFrom;
            if (dateTo) document.getElementById('date-to').value = dateTo;
            if (enableDateFilter) document.getElementById('enable-date-filter').checked = true;
        }
    </script>
</body>
</html>